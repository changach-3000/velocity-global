/// <reference path="../pb_data/types.d.ts" />
migrate((app) => {
  const collection = app.findCollectionByNameOrId("lesson_content");

  const record0 = new Record(collection);
    record0.set("lesson_id", "<LESSON_2_1_ID>");
    record0.set("content_body", "# Lease Portfolio Selection and Due Diligence\n\n## Portfolio Selection Criteria\n\n### Criterion 1: Lease Quality\n- Strong credit quality lessees (FICO > 700)\n- Low default probability\n- Investment-grade lessees (95%+)\n- Established payment history\n\n### Criterion 2: Lease Diversification\n- Geographic diversification (50+ states)\n- Industry diversification (20+ industries)\n- Lessee concentration (no single lessee > 5%)\n- Mixed lessee sizes\n\n### Criterion 3: Lease Terms\n- Appropriate lease term (3-5 years)\n- Reasonable payment amounts ($10K/month average)\n- Clear payment schedule (monthly preferred)\n- Standard payment frequency\n\n### Criterion 4: Collateral Quality\n- Equipment in good condition\n- Reasonable residual value (40% average)\n- Marketable equipment (standard, not specialized)\n- Equipment condition assessment required\n\n### Criterion 5: Documentation Quality\n- Complete lease documentation (100%)\n- Clear payment terms\n- Proper legal structure\n- Legal compliance verified\n\n## Due Diligence Process\n\n1. **Portfolio Review**: Review 100 lease agreements, verify terms, assess quality\n2. **Lessee Credit Analysis**: Analyze credit quality, review financials, assess payment history\n3. **Equipment Valuation**: Assess condition, determine residual values, evaluate marketability\n4. **Payment History**: Review 24-month history, identify delinquencies, assess collection rates (99%+)\n5. **Legal Review**: Verify documentation, confirm compliance, assess enforceability\n6. **Operational Review**: Review servicing procedures, assess collections, evaluate default management\n7. **Risk Assessment**: Identify portfolio risks, assess concentration, evaluate market risks\n8. **Reporting**: Prepare due diligence report, document findings, provide recommendations\n\n## Portfolio Metrics\n\n- **WAL (Weighted Average Life)**: 3.5 years - average time to principal repayment\n- **WAC (Weighted Average Coupon)**: 5.5% - average interest rate on leases\n- **WART (Weighted Average Remaining Term)**: 3.2 years - average remaining lease term\n- **Default Rate**: 2% - percentage of leases in default\n- **Loss Severity**: 15% - percentage loss on defaulted leases\n\n## Case Study: PortfolioCorp\n\n**Portfolio:** 100 leases, $50M, 4-year average term, $10K monthly payments\n\n**Selection Results:**\n- Lease Quality: Average FICO 750, 95% investment-grade\n- Diversification: 45 states, 18 industries, mixed sizes\n- Terms: 4-year average, $10K monthly\n- Collateral: Good condition, 40% residual value\n- Documentation: 100% complete, legally compliant\n\n**Due Diligence Results:**\n- All 100 leases reviewed and verified\n- 100 lessees analyzed, excellent payment history\n- 100 items appraised, good marketability\n- 24-month review: 1% delinquencies, 99% collection rate\n- 100% compliance, strong enforceability\n- Excellent servicing, efficient collections\n- Low portfolio and concentration risks\n\n**Outcome:** Portfolio selected for securitization, due diligence completed, ready for structuring.");
  app.save(record0);

  const record1 = new Record(collection);
    record1.set("lesson_id", "<LESSON_2_2_ID>");
    record1.set("content_body", "# Securitization Structuring and Tranching\n\n## Structuring Principles\n\n### Principle 1: Risk Allocation\n- Allocate risk across tranches\n- Senior tranches lower risk (AAA)\n- Subordinated tranches higher risk (BBB)\n- Example: 70% AAA, 20% A, 10% BBB\n- Attracts diverse investors and optimizes pricing\n\n### Principle 2: Credit Enhancement\n- Protect senior tranches from losses\n- Subordination: Lower tranches absorb losses first\n- Overcollateralization: Assets exceed liabilities\n- Reserve accounts: Cash reserves for losses\n- Excess spread: Difference between asset yield and liability cost\n\n### Principle 3: Cash Flow Optimization\n- Optimize cash flow distribution\n- Maximize investor returns\n- Manage timing (monthly vs. quarterly)\n- Attracts investors and improves pricing\n\n## Tranching Strategies\n\n### Strategy 1: Sequential Pay\n- Senior tranche paid first\n- Mezzanine tranche paid second\n- Subordinated tranche paid last\n- Simple structure with clear priority\n\n### Strategy 2: Pro-Rata Pay\n- All tranches paid proportionally\n- Based on tranche size (70% AAA, 20% A, 10% BBB)\n- Faster paydown and shorter duration\n\n### Strategy 3: Subordinated Tranches\n- Subordinated tranches absorb losses\n- Protect senior tranches\n- Example: BBB absorbs first 10% losses\n\n## Structuring Mechanics\n\n1. **Determine Tranche Sizes**: 70% AAA ($35M), 20% A ($10M), 10% BBB ($5M)\n2. **Determine Coupon Rates**: AAA 5%, A 6%, BBB 8%\n3. **Design Credit Enhancement**: 30% subordination, 10% OC, 5% reserve\n4. **Model Cash Flows**: Project $500K/month, model 2% default rate\n5. **Stress Test**: Test 5% and 10% default rates, verify protection\n\n## Case Study: StructuringCorp\n\n**Portfolio:** $50M, WAL 3.5 years, WAC 5.5%, Default 2%, Loss severity 15%\n\n**Tranche Structure:**\n- Senior (AAA): $35M (70%)\n- Mezzanine (A): $10M (20%)\n- Subordinated (BBB): $5M (10%)\n\n**Coupon Rates:**\n- Senior: 5.0%\n- Mezzanine: 6.0%\n- Subordinated: 8.0%\n\n**Credit Enhancement:**\n- Subordination: 30% (BBB + A)\n- Overcollateralization: 10% ($5M)\n- Reserve account: 5% ($2.5M)\n- Excess spread: 2%\n\n**Cash Flow Modeling:**\n- Expected collections: $500K/month\n- Expected defaults: 2% annually\n- Expected losses: $15K/month\n- Expected excess spread: $10K/month\n\n**Stress Testing:**\n- Base case (2% default): All tranches protected\n- Stress case (5% default): All tranches protected\n- Severe case (10% default): All tranches protected\n\n**Outcome:** Structure optimized, tranches sized appropriately, credit enhancement adequate, ready for rating.");
  app.save(record1);

  const record2 = new Record(collection);
    record2.set("lesson_id", "<LESSON_2_3_ID>");
    record2.set("content_body", "# Rating and Pricing Securitized Leases\n\n## Rating Methodologies\n\n### Approach 1: Structural Analysis\n- Analyze portfolio credit quality\n- Assess credit enhancement mechanisms\n- Determine rating based on protection levels\n- Factors: Default rate (2%), loss severity (15%), subordination (30%), OC (10%)\n\n### Approach 2: Scenario Analysis\n- Model various default scenarios\n- Assess tranche protection under stress\n- Determine rating stability\n- Scenarios: Base (2%), Stress (5%), Severe (10%)\n\n### Approach 3: Comparative Analysis\n- Compare to similar deals\n- Assess relative risk\n- Determine rating based on comparables\n- Consider portfolio characteristics and structure\n\n## Pricing Mechanisms\n\n### Pricing Components:\n\n**Base Rate (LIBOR/SOFR):** 5.0%\n- Reference rate varies with market conditions\n- Adjusts with interest rate environment\n\n**Credit Spread:**\n- AAA: 50 bps (0.50%)\n- A: 150 bps (1.50%)\n- BBB: 300 bps (3.00%)\n- Varies with rating and credit risk\n\n**Liquidity Spread:** 25 bps (0.25%)\n- Additional yield for liquidity risk\n- Varies with market conditions\n\n**Complexity Spread:** 10 bps (0.10%)\n- Additional yield for deal complexity\n- Varies with structure\n\n## Case Study: RatingCorp\n\n**Portfolio:** $50M, Default 2%, Loss severity 15%\n\n**Rating Analysis:**\n\n**Senior Tranche (AAA):**\n- Subordination: 30%, OC: 10%, Reserve: 5%\n- Rating: AAA\n\n**Mezzanine Tranche (A):**\n- Subordination: 10%, OC: 10%, Reserve: 5%\n- Rating: A\n\n**Subordinated Tranche (BBB):**\n- No subordination, OC: 10%, Reserve: 5%\n- Rating: BBB\n\n**Pricing Analysis:**\n\n**Senior Tranche (AAA):**\n- Base rate: 5.0%\n- Credit spread: 0.50%\n- Liquidity spread: 0.25%\n- Complexity spread: 0.10%\n- **Total coupon: 5.85%**\n\n**Mezzanine Tranche (A):**\n- Base rate: 5.0%\n- Credit spread: 1.50%\n- Liquidity spread: 0.25%\n- Complexity spread: 0.10%\n- **Total coupon: 6.85%**\n\n**Subordinated Tranche (BBB):**\n- Base rate: 5.0%\n- Credit spread: 3.00%\n- Liquidity spread: 0.25%\n- Complexity spread: 0.10%\n- **Total coupon: 8.35%**\n\n**Outcome:** All tranches rated and priced, ready for marketing and distribution to investors.");
  app.save(record2);
}, (app) => {
  // Rollback: record IDs not known, manual cleanup needed
})
