/// <reference path="../pb_data/types.d.ts" />
migrate((app) => {
  const collection = app.findCollectionByNameOrId("lesson_content");

  const record0 = new Record(collection);
    record0.set("lesson_id", "LESSON 2.1: Residual Value Management and Risk");
    record0.set("content_body", "SECTION 1: RESIDUAL VALUE FUNDAMENTALS\n\nDefinition:\n- Expected equipment value at lease end\n- Estimated remaining useful life value\n- Example: $50,000 residual value on $500,000 equipment\n\nKey Concepts:\n\nConcept 1: Residual Value Percentage\n- Residual as percentage of equipment cost\n- Typical range: 10-30%\n- Example: 10% residual on $500,000 = $50,000\n\nConcept 2: Residual Value Guarantee\n- Lessor guarantees minimum residual value\n- Lessee pays difference if actual less than guaranteed\n- Example: $50,000 guaranteed residual\n\nConcept 3: Residual Value Risk\n- Risk that actual value less than expected\n- Lessor bears risk in operating lease\n- Lessee bears risk in capital lease\n- Example: Equipment worth $40,000 instead of $50,000\n\nConcept 4: Residual Value Realization\n- Actual value received at lease end\n- Sale of equipment\n- Example: Equipment sold for $48,000\n\nSECTION 2: RESIDUAL VALUE ESTIMATION\n\nMethod 1: Historical Data Analysis\n- Analyze historical residual values\n- Identify trends\n- Example: Historical data shows 15% residual\n\nMethod 2: Market Analysis\n- Analyze current market values\n- Identify market trends\n- Example: Market analysis shows 12% residual\n\nMethod 3: Equipment Condition Analysis\n- Assess equipment condition\n- Estimate remaining useful life\n- Example: Equipment in good condition, 5 years remaining\n\nMethod 4: Technology Analysis\n- Assess technology obsolescence risk\n- Estimate technology life\n- Example: Technology life 5 years\n\nMethod 5: Expert Opinion\n- Consult equipment experts\n- Obtain professional appraisals\n- Example: Expert estimates 15% residual");
  app.save(record0);

  const record1 = new Record(collection);
    record1.set("lesson_id", "LESSON 2.1: Residual Value Management and Risk");
    record1.set("content_body", "SECTION 3: RESIDUAL VALUE RISK MANAGEMENT\n\nRisk 1: Obsolescence Risk\n- Equipment becomes obsolete\n- Technology changes\n- Mitigation: Shorter lease terms, upgrade options\n- Example: Technology equipment becomes obsolete\n\nRisk 2: Condition Risk\n- Equipment condition deteriorates\n- Wear and tear\n- Mitigation: Maintenance requirements, condition inspections\n- Example: Equipment condition worse than expected\n\nRisk 3: Market Risk\n- Equipment market value declines\n- Supply/demand changes\n- Mitigation: Diversified portfolio, market analysis\n- Example: Equipment market value declines 20%\n\nRisk 4: Demand Risk\n- Low demand for used equipment\n- Difficulty selling equipment\n- Mitigation: Diversified customer base, secondary markets\n- Example: Difficulty finding buyer for used equipment\n\nRisk 5: Regulatory Risk\n- Regulatory changes affect value\n- Environmental regulations\n- Mitigation: Monitor regulatory environment\n- Example: Environmental regulations reduce equipment value\n\nSECTION 4: RESIDUAL VALUE STRATEGIES\n\nStrategy 1: Conservative Residual Estimates\n- Estimate lower residual values\n- Reduce residual value risk\n- Example: Estimate 10% residual instead of 15%\n\nStrategy 2: Residual Value Guarantees\n- Lessee guarantees residual value\n- Lessor protected from downside\n- Example: Lessee guarantees $50,000 residual\n\nStrategy 3: Residual Value Insurance\n- Purchase insurance for residual value\n- Protect against value decline\n- Example: Residual value insurance covers 80% of decline\n\nStrategy 4: Residual Value Sharing\n- Share residual value gains/losses\n- Align incentives\n- Example: Share 50% of residual value gains\n\nStrategy 5: Residual Value Buyout\n- Lessee buys equipment at residual value\n- Lessor receives guaranteed payment\n- Example: Lessee buys equipment for $50,000");
  app.save(record1);

  const record2 = new Record(collection);
    record2.set("lesson_id", "LESSON 2.1: Residual Value Management and Risk");
    record2.set("content_body", "SECTION 5: RESIDUAL VALUE IMPACT ON LEASE PRICING\n\nImpact 1: Higher Residual = Lower Payment\n- Higher residual value reduces lease payment\n- Example: 15% residual = $9,000/month vs 10% residual = $10,000/month\n\nImpact 2: Lower Residual = Higher Payment\n- Lower residual value increases lease payment\n- Example: 10% residual = $10,000/month vs 5% residual = $11,000/month\n\nImpact 3: Residual Guarantee Impact\n- Residual guarantee increases lessor cost\n- Increases lease payment\n- Example: Guaranteed residual increases payment $500/month\n\nImpact 4: Residual Value Sharing Impact\n- Residual value sharing reduces lessor return\n- Reduces lease payment\n- Example: 50% residual sharing reduces payment $500/month\n\nSECTION 6: CASE STUDY - RESIDUAL VALUE MANAGEMENT\n\nEquipment: Manufacturing equipment\nCost: $500,000\nLease term: 5 years\n\nResidual Value Analysis:\n\nHistorical Data:\n- 5-year residual: 12-15%\n- Average: 13.5%\n\nMarket Analysis:\n- Current market: 12-14%\n- Trend: Declining 1% per year\n- Estimated: 10% at lease end\n\nEquipment Condition:\n- New equipment\n- Good condition expected\n- Maintenance included\n- Estimated: 12% residual\n\nTechnology Analysis:\n- Technology life: 5-7 years\n- Obsolescence risk: Low\n- Estimated: 12% residual\n\nExpert Opinion:\n- Equipment expert: 11-13%\n- Average: 12%\n\nResidual Value Estimate:\n- Conservative: 10% = $50,000\n- Base case: 12% = $60,000\n- Optimistic: 15% = $75,000\n\nLease Pricing Impact:\n\nConservative Residual (10%):\n- Residual value: $50,000\n- Monthly payment: $10,000\n- Total payments: $600,000\n- Lessor return: 8.5%\n\nBase Case Residual (12%):\n- Residual value: $60,000\n- Monthly payment: $9,500\n- Total payments: $570,000\n- Lessor return: 8.5%\n\nOptimistic Residual (15%):\n- Residual value: $75,000\n- Monthly payment: $9,000\n- Total payments: $540,000\n- Lessor return: 8.5%\n\nRisk Management:\n\nSelected Structure:\n- Residual estimate: 12% = $60,000\n- Residual guarantee: None\n- Residual insurance: Yes (covers 80% of decline below 10%)\n- Residual sharing: No\n- Monthly payment: $9,500\n\nOutcome:\n- Residual value managed\n- Risk mitigated through insurance\n- Lease pricing optimized\n- Lessor return: 8.5%");
  app.save(record2);

  const record3 = new Record(collection);
    record3.set("lesson_id", "LESSON 2.2: Payment Structures and Optimization");
    record3.set("content_body", "SECTION 1: PAYMENT STRUCTURE TYPES\n\nType 1: Level Payments\n- Same payment every period\n- Simple structure\n- Example: $10,000/month for 60 months\n\nType 2: Escalating Payments\n- Payments increase over time\n- Matches revenue growth\n- Example: $9,000 year 1, $10,000 year 2, $11,000 year 3\n\nType 3: Declining Payments\n- Payments decrease over time\n- Front-loaded structure\n- Example: $11,000 year 1, $10,000 year 2, $9,000 year 3\n\nType 4: Seasonal Payments\n- Payments vary by season\n- Matches seasonal revenue\n- Example: Higher payments in peak season\n\nType 5: Stepped Payments\n- Payments increase in steps\n- Matches business milestones\n- Example: $9,000 for 2 years, $10,000 for 3 years\n\nSECTION 2: PAYMENT FREQUENCY OPTIONS\n\nFrequency 1: Monthly Payments\n- Most common\n- 12 payments per year\n- Example: $10,000/month\n\nFrequency 2: Quarterly Payments\n- 4 payments per year\n- Larger payment amounts\n- Example: $30,000/quarter\n\nFrequency 3: Semi-Annual Payments\n- 2 payments per year\n- Larger payment amounts\n- Example: $60,000/semi-annual\n\nFrequency 4: Annual Payments\n- 1 payment per year\n- Largest payment amount\n- Example: $120,000/annual\n\nFrequency 5: Advance Payments\n- Payment at beginning of period\n- Reduces lessor risk\n- Example: Payment due on 1st of month");
  app.save(record3);

  const record4 = new Record(collection);
    record4.set("lesson_id", "LESSON 2.2: Payment Structures and Optimization");
    record4.set("content_body", "SECTION 3: PAYMENT OPTIMIZATION STRATEGIES\n\nStrategy 1: Lessee Cash Flow Matching\n- Match payments to lessee cash flow\n- Improve lessee affordability\n- Example: Escalating payments match revenue growth\n\nStrategy 2: Lessor Return Optimization\n- Optimize lessor return\n- Maximize present value\n- Example: Front-loaded payments increase return\n\nStrategy 3: Risk Mitigation\n- Reduce default risk\n- Improve payment certainty\n- Example: Advance payments reduce risk\n\nStrategy 4: Competitive Positioning\n- Competitive payment structures\n- Differentiate from competitors\n- Example: Flexible payment options\n\nStrategy 5: Tax Optimization\n- Optimize tax treatment\n- Maximize tax benefits\n- Example: Payment structure affects tax classification\n\nSECTION 4: PAYMENT STRUCTURE IMPACT ON RETURNS\n\nImpact 1: Payment Timing\n- Earlier payments increase return\n- Later payments decrease return\n- Example: Advance payment increases return 0.5%\n\nImpact 2: Payment Amount\n- Higher payments increase return\n- Lower payments decrease return\n- Example: $10,000/month vs $9,000/month\n\nImpact 3: Payment Frequency\n- More frequent payments increase return\n- Less frequent payments decrease return\n- Example: Monthly vs quarterly payments\n\nImpact 4: Payment Escalation\n- Escalating payments increase return\n- Declining payments decrease return\n- Example: Escalating 5% annually increases return 0.3%");
  app.save(record4);

  const record5 = new Record(collection);
    record5.set("lesson_id", "LESSON 2.2: Payment Structures and Optimization");
    record5.set("content_body", "SECTION 5: PAYMENT STRUCTURE EXAMPLES\n\nExample 1: Level Payments\n- Equipment: $500,000\n- Term: 5 years (60 months)\n- Payment: $10,000/month\n- Total payments: $600,000\n- Lessor return: 8.5%\n\nExample 2: Escalating Payments\n- Equipment: $500,000\n- Term: 5 years\n- Year 1: $9,000/month\n- Year 2: $9,500/month\n- Year 3: $10,000/month\n- Year 4: $10,500/month\n- Year 5: $11,000/month\n- Total payments: $600,000\n- Lessor return: 8.5%\n\nExample 3: Declining Payments\n- Equipment: $500,000\n- Term: 5 years\n- Year 1: $11,000/month\n- Year 2: $10,500/month\n- Year 3: $10,000/month\n- Year 4: $9,500/month\n- Year 5: $9,000/month\n- Total payments: $600,000\n- Lessor return: 8.5%\n\nExample 4: Seasonal Payments\n- Equipment: $500,000\n- Term: 5 years\n- Peak season: $12,000/month\n- Off-season: $8,000/month\n- Average: $10,000/month\n- Total payments: $600,000\n- Lessor return: 8.5%\n\nSECTION 6: CASE STUDY - PAYMENT STRUCTURE OPTIMIZATION\n\nLessee: ManufacturingCorp\nEquipment: Manufacturing equipment\nCost: $500,000\nLease term: 5 years\n\nLessee Cash Flow Analysis:\n\nYear 1: $1,000,000 revenue, $100,000 available for lease\nYear 2: $1,200,000 revenue, $120,000 available for lease\nYear 3: $1,400,000 revenue, $140,000 available for lease\nYear 4: $1,600,000 revenue, $160,000 available for lease\nYear 5: $1,800,000 revenue, $180,000 available for lease\n\nPayment Structure Options:\n\nOption 1: Level Payments\n- Monthly payment: $10,000\n- Annual payment: $120,000\n- Year 1: Tight cash flow (120% of available)\n- Year 5: Comfortable (67% of available)\n- Risk: Default in year 1\n\nOption 2: Escalating Payments\n- Year 1: $8,000/month ($96,000/year)\n- Year 2: $9,000/month ($108,000/year)\n- Year 3: $10,000/month ($120,000/year)\n- Year 4: $11,000/month ($132,000/year)\n- Year 5: $12,000/month ($144,000/year)\n- Total: $600,000\n- Matches cash flow growth\n- Risk: Low\n\nOption 3: Seasonal Payments\n- Peak season: $12,000/month\n- Off-season: $8,000/month\n- Average: $10,000/month\n- Matches seasonal revenue\n- Risk: Low\n\nSelected Structure:\n- Escalating payments\n- Matches lessee cash flow\n- Reduces default risk\n- Lessor return: 8.5%\n\nOutcome:\n- Payment structure optimized\n- Lessee cash flow matched\n- Default risk reduced\n- Lease structured successfully");
  app.save(record5);

  const record6 = new Record(collection);
    record6.set("lesson_id", "LESSON 2.3: Tax-Efficient Lease Structures");
    record6.set("content_body", "SECTION 1: TAX LEASE CLASSIFICATION\n\nDefinition:\n- Lease classified as tax lease\n- Lessor claims depreciation\n- Lessor claims interest deduction\n- Example: Tax lease structure\n\nTax Lease Requirements:\n\nRequirement 1: Lessor Retains Ownership\n- Lessor must retain legal title\n- Lessor must retain economic ownership\n- Example: Lessor owns equipment\n\nRequirement 2: Lessee Does Not Retain Ownership\n- Lessee does not have purchase option\n- Lessee does not have bargain purchase option\n- Example: No purchase option available\n\nRequirement 3: Lease Term\n- Lease term less than equipment life\n- Typically 60-80% of equipment life\n- Example: 5-year lease on 7-year equipment\n\nRequirement 4: Residual Value\n- Lessor retains residual value\n- Residual value at least 20% of cost\n- Example: 20% residual value\n\nRequirement 5: No Lessee Guarantees\n- Lessee does not guarantee residual value\n- Lessee does not guarantee purchase price\n- Example: No residual value guarantee\n\nSECTION 2: TAX BENEFITS OF LEASING\n\nBenefit 1: Depreciation Deductions\n- Lessor claims depreciation\n- Reduces taxable income\n- Example: $100,000 depreciation deduction\n\nBenefit 2: Interest Deductions\n- Lessor claims interest on debt\n- Reduces taxable income\n- Example: $50,000 interest deduction\n\nBenefit 3: Investment Tax Credits\n- Lessor claims investment tax credits\n- Reduces tax liability\n- Example: $50,000 investment tax credit\n\nBenefit 4: Accelerated Depreciation\n- Lessor uses accelerated depreciation\n- Front-loads deductions\n- Example: MACRS depreciation\n\nBenefit 5: Section 179 Deductions\n- Lessor claims Section 179 deductions\n- Immediate deduction\n- Example: $1,000,000 Section 179 deduction");
  app.save(record6);

  const record7 = new Record(collection);
    record7.set("lesson_id", "LESSON 2.3: Tax-Efficient Lease Structures");
    record7.set("content_body", "SECTION 3: TAX-EFFICIENT STRUCTURING STRATEGIES\n\nStrategy 1: Maximize Depreciation\n- Structure to maximize depreciation deductions\n- Use accelerated depreciation methods\n- Example: MACRS depreciation\n\nStrategy 2: Optimize Debt Financing\n- Use debt financing to increase deductions\n- Leverage debt for tax benefits\n- Example: 70% debt financing\n\nStrategy 3: Residual Value Optimization\n- Optimize residual value for tax purposes\n- Balance tax and financial objectives\n- Example: 20% residual value\n\nStrategy 4: Lease Term Optimization\n- Optimize lease term for tax purposes\n- Ensure tax lease classification\n- Example: 5-year lease on 7-year equipment\n\nStrategy 5: Equipment Selection\n- Select equipment with favorable tax treatment\n- Maximize tax benefits\n- Example: Equipment eligible for investment tax credits\n\nSECTION 4: TAX LEASE VS NON-TAX LEASE\n\nTax Lease:\n- Lessor claims depreciation\n- Lessor claims interest deduction\n- Lessor claims investment tax credits\n- Lessor retains ownership\n- Lessee does not have purchase option\n- Example: True lease structure\n\nNon-Tax Lease:\n- Lessee claims depreciation\n- Lessee claims interest deduction\n- Lessee claims investment tax credits\n- Lessee has purchase option\n- Lessee retains economic ownership\n- Example: Capital lease structure\n\nTax Implications:\n\nTax Lease:\n- Lessor tax benefits: High\n- Lessee tax benefits: Low\n- Lessor return: Higher\n- Lessee cost: Lower\n- Example: Lessor benefits from tax deductions\n\nNon-Tax Lease:\n- Lessor tax benefits: Low\n- Lessee tax benefits: High\n- Lessor return: Lower\n- Lessee cost: Higher\n- Example: Lessee benefits from tax deductions");
  app.save(record7);

  const record8 = new Record(collection);
    record8.set("lesson_id", "LESSON 2.3: Tax-Efficient Lease Structures");
    record8.set("content_body", "SECTION 5: TAX LEASE STRUCTURING CONSIDERATIONS\n\nConsideration 1: Lessor Tax Position\n- Lessor must have tax liability\n- Lessor must be able to use deductions\n- Example: Lessor with $1M+ tax liability\n\nConsideration 2: Lessee Tax Position\n- Lessee tax position affects pricing\n- Lessee with low tax liability may prefer non-tax lease\n- Example: Non-profit lessee prefers non-tax lease\n\nConsideration 3: Regulatory Compliance\n- Ensure tax lease requirements met\n- Ensure IRS compliance\n- Example: Ensure 20% residual value requirement\n\nConsideration 4: Documentation\n- Proper documentation required\n- Lessor must document tax lease intent\n- Example: Tax lease documentation\n\nConsideration 5: Risk Management\n- Tax law changes risk\n- IRS challenge risk\n- Mitigation: Professional tax advice\n- Example: Obtain tax opinion\n\nSECTION 6: CASE STUDY - TAX-EFFICIENT LEASE STRUCTURE\n\nEquipment: Manufacturing equipment\nCost: $500,000\nLease term: 5 years\nEquipment life: 7 years\n\nTax Lease Analysis:\n\nTax Lease Requirements:\n\nRequirement 1: Lessor Retains Ownership\n- Lessor retains legal title\n- Lessor retains economic ownership\n- Status: Met\n\nRequirement 2: Lessee Does Not Retain Ownership\n- No purchase option\n- No bargain purchase option\n- Status: Met\n\nRequirement 3: Lease Term\n- Lease term: 5 years\n- Equipment life: 7 years\n- Percentage: 71% of equipment life\n- Status: Met (less than 80%)\n\nRequirement 4: Residual Value\n- Residual value: $60,000\n- Percentage: 12% of cost\n- Status: Not met (less than 20%)\n\nRequirement 5: No Lessee Guarantees\n- No residual value guarantee\n- No purchase price guarantee\n- Status: Met\n\nTax Lease Status: Not qualified (residual value less than 20%)\n\nRestructuring for Tax Lease:\n\nOption 1: Increase Residual Value\n- Residual value: $100,000\n- Percentage: 20% of cost\n- Status: Meets requirement\n- Impact: Reduces lease payment to $9,000/month\n\nOption 2: Shorten Lease Term\n- Lease term: 4 years\n- Percentage: 57% of equipment life\n- Status: Meets requirement\n- Impact: Increases lease payment to $11,000/month\n\nOption 3: Different Equipment\n- Equipment with longer life\n- Residual value 20%+\n- Status: Meets requirement\n\nSelected Structure:\n- Increase residual value to $100,000\n- Lease term: 5 years\n- Monthly payment: $9,000\n- Tax lease qualified\n\nTax Benefits:\n\nDepreciation:\n- Depreciable basis: $400,000 ($500,000 - $100,000 residual)\n- MACRS depreciation: 5-year property\n- Year 1 depreciation: $80,000\n- Tax savings: $20,000 (25% tax rate)\n\nInterest Deduction:\n- Debt financing: $350,000\n- Interest rate: 5%\n- Year 1 interest: $17,500\n- Tax savings: $4,375\n\nInvestment Tax Credits:\n- Equipment eligible for ITC\n- ITC: $50,000\n- Tax savings: $50,000\n\nTotal Tax Benefits:\n- Year 1: $74,375\n- 5-year total: $200,000+\n\nOutcome:\n- Tax lease structure qualified\n- Significant tax benefits\n- Lessor return: 8.5%\n- Lease structured successfully");
  app.save(record8);
}, (app) => {
  // Rollback: record IDs not known, manual cleanup needed
})
